{"ast":null,"code":"import _toConsumableArray from\"D:\\\\Real-Tic-Tac-Toe\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\toConsumableArray.js\";import _slicedToArray from\"D:\\\\Real-Tic-Tac-Toe\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import React,{useState,useEffect}from\"react\";// import message from \"./Messages\";\nimport getDate from\"./getDate\";import{useSelector,useDispatch}from\"react-redux\";import useWebSocket,{ReadyState}from\"react-use-websocket\";import ArrowDropDownCircleIcon from\"@mui/icons-material/ArrowDropDownCircle\";import SendIcon from\"@mui/icons-material/Send\";import Button from\"@mui/material/Button\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Chat=function Chat(props){var room=localStorage.getItem(\"room\");var symbols=localStorage.getItem(\"sym\");var _useState=useState(false),_useState2=_slicedToArray(_useState,2),downarrow=_useState2[0],setDownarrow=_useState2[1];var _useState3=useState(\"wss://api-tictactoe-by-sp.online/ws/chat/\"+room+\"_chat\"+\"/\"+symbols+\"/\"),_useState4=_slicedToArray(_useState3,2),socketUrl=_useState4[0],setSocketUrl=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),messageHistory=_useState6[0],setMessageHistory=_useState6[1];var _useWebSocket=useWebSocket(socketUrl),sendMessage=_useWebSocket.sendMessage,lastMessage=_useWebSocket.lastMessage,readyState=_useWebSocket.readyState;var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),message=_useState8[0],setMessage=_useState8[1];useEffect(function(){if(lastMessage!==null){setMessageHistory(function(prev){return prev.concat(lastMessage);});// setMessage([...JSON.parse(lastMessage.data)]);\n// JSON.parse(lastMessage.data);\nsetMessage([].concat(_toConsumableArray(message),[JSON.parse(lastMessage.data)]));}},[lastMessage,setMessageHistory]);var oppo=useSelector(function(state){return state.opponent.opponent;});var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),value=_useState10[0],setValue=_useState10[1];return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{id:\"chat\",className:\"boxes\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"chat-screen notscroll\",onScroll:function onScroll(){var scrn=document.querySelector(\".chat-screen\");var scrollbtn=document.querySelector(\".botarrow\");scrn.classList.add(\"wow\");scrn.classList.remove(\"notscroll\");if(scrn.clientHeight+scrn.scrollTop>=scrn.scrollHeight-10){setDownarrow(false);console.log(\"scrolled\");}else{setDownarrow(true);}setTimeout(function(){scrn.classList.remove(\"wow\");scrn.classList.add(\"notscroll\");},3000);},children:/*#__PURE__*/_jsx(\"div\",{className:\"mySide\",children:message.map(function(val,index){console.log(val);var clas=val.msg_sym==localStorage.getItem(\"sym\")?\"my-msg\":\"oth-msg\";var label=val.msg_sym==localStorage.getItem(\"sym\")?\"You\":\"He\";return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:clas,children:[/*#__PURE__*/_jsx(\"label\",{children:val.label===localStorage.getItem(\"name\")?\"You\":val.label}),/*#__PURE__*/_jsx(\"div\",{children:val.msg}),/*#__PURE__*/_jsx(\"span\",{children:val.time})]},index)});})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"txtarea\",children:[/*#__PURE__*/_jsx(\"textarea\",{name:\"message\",placeholder:\"Enter message here\",id:\"msg-box\",cols:\"30\",rows:\"2\",value:value,onChange:function onChange(e){setValue(e.target.value);}}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"error\",style:{margin:\"10px 0\"},onClick:function onClick(){if(!oppo){return;}if(value!==\"\"){sendMessage(JSON.stringify({msg:value,msg_sym:localStorage.getItem(\"sym\"),label:localStorage.getItem(\"name\"),time:getDate()}));}setValue(\"\");},children:/*#__PURE__*/_jsx(SendIcon,{})})]})]})});};export default Chat;","map":{"version":3,"sources":["D:/Real-Tic-Tac-Toe/client-application/src/features/game/Chat.jsx"],"names":["React","useState","useEffect","getDate","useSelector","useDispatch","useWebSocket","ReadyState","ArrowDropDownCircleIcon","SendIcon","Button","Chat","props","room","localStorage","getItem","symbols","downarrow","setDownarrow","socketUrl","setSocketUrl","messageHistory","setMessageHistory","sendMessage","lastMessage","readyState","message","setMessage","prev","concat","JSON","parse","data","oppo","state","opponent","value","setValue","scrn","document","querySelector","scrollbtn","classList","add","remove","clientHeight","scrollTop","scrollHeight","console","log","setTimeout","map","val","index","clas","msg_sym","label","msg","time","e","target","margin","stringify"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\n// import message from \"./Messages\";\r\nimport getDate from \"./getDate\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport useWebSocket, { ReadyState } from \"react-use-websocket\";\r\nimport ArrowDropDownCircleIcon from \"@mui/icons-material/ArrowDropDownCircle\";\r\nimport SendIcon from \"@mui/icons-material/Send\";\r\nimport Button from \"@mui/material/Button\";\r\nconst Chat = (props) => {\r\n  var room = localStorage.getItem(\"room\");\r\n  var symbols = localStorage.getItem(\"sym\");\r\n  const [downarrow, setDownarrow] = useState(false);\r\n\r\n  const [socketUrl, setSocketUrl] = useState(\r\n    \"wss://api-tictactoe-by-sp.online/ws/chat/\" + room + \"_chat\" + \"/\" + symbols + \"/\"\r\n  );\r\n  const [messageHistory, setMessageHistory] = useState([]);\r\n  const { sendMessage, lastMessage, readyState } = useWebSocket(socketUrl);\r\n  const [message, setMessage] = useState([]);\r\n  useEffect(() => {\r\n    if (lastMessage !== null) {\r\n      setMessageHistory((prev) => prev.concat(lastMessage));\r\n      // setMessage([...JSON.parse(lastMessage.data)]);\r\n      // JSON.parse(lastMessage.data);\r\n      setMessage([...message, JSON.parse(lastMessage.data)]);\r\n    }\r\n  }, [lastMessage, setMessageHistory]);\r\n  const oppo = useSelector((state) => state.opponent.opponent);\r\n  const [value, setValue] = useState(\"\");\r\n  return (\r\n    <>\r\n      <div id=\"chat\" className=\"boxes\">\r\n        <div\r\n          className=\"chat-screen notscroll\"\r\n          onScroll={() => {\r\n            const scrn = document.querySelector(\".chat-screen\");\r\n            const scrollbtn = document.querySelector(\".botarrow\");\r\n            scrn.classList.add(\"wow\");\r\n            scrn.classList.remove(\"notscroll\");\r\n\r\n            if (scrn.clientHeight + scrn.scrollTop >= scrn.scrollHeight - 10) {\r\n              setDownarrow(false);\r\n              console.log(\"scrolled\");\r\n            } else {\r\n              setDownarrow(true);\r\n            }\r\n\r\n            setTimeout(() => {\r\n              scrn.classList.remove(\"wow\");\r\n              scrn.classList.add(\"notscroll\");\r\n            }, 3000);\r\n          }}\r\n        >\r\n          <div className=\"mySide\">\r\n            {message.map((val, index) => {\r\n              console.log(val);\r\n              let clas =\r\n                val.msg_sym == localStorage.getItem(\"sym\")\r\n                  ? \"my-msg\"\r\n                  : \"oth-msg\";\r\n              let label =\r\n                val.msg_sym == localStorage.getItem(\"sym\") ? \"You\" : \"He\";\r\n              return (\r\n                <>\r\n                  <div className={clas} key={index}>\r\n                    <label>\r\n                      {val.label === localStorage.getItem(\"name\")\r\n                        ? \"You\"\r\n                        : val.label}\r\n                    </label>\r\n                    <div>{val.msg}</div>\r\n                    <span>{val.time}</span>\r\n                  </div>\r\n                </>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n        <div className=\"txtarea\">\r\n          <textarea\r\n            name=\"message\"\r\n            placeholder=\"Enter message here\"\r\n            id=\"msg-box\"\r\n            cols=\"30\"\r\n            rows=\"2\"\r\n            value={value}\r\n            onChange={(e) => {\r\n              setValue(e.target.value);\r\n            }}\r\n          ></textarea>\r\n          <Button\r\n            variant=\"contained\"\r\n            color=\"error\"\r\n            style={{ margin: \"10px 0\" }}\r\n            onClick={() => {\r\n              if (!oppo) {\r\n                return;\r\n              }\r\n              if (value !== \"\") {\r\n                sendMessage(\r\n                  JSON.stringify({\r\n                    msg: value,\r\n                    msg_sym: localStorage.getItem(\"sym\"),\r\n                    label: localStorage.getItem(\"name\"),\r\n                    time: getDate(),\r\n                  })\r\n                );\r\n              }\r\n              setValue(\"\");\r\n            }}\r\n          >\r\n            <SendIcon />\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Chat;\r\n"]},"metadata":{},"sourceType":"module"}